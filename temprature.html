<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather ‚Äì Minimal, Fast & Free (Open‚ÄëMeteo)</title>
  <style>
    :root{
      --bg:#0b1020;--panel:#111831;--muted:#9aa4bf;--text:#e8ecf8;--accent:#7aa2ff;--accent-2:#8ef0c2;--danger:#ff6b6b;
      --radius:18px
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans",sans-serif;background:radial-gradient(1200px 800px at 10% -10%,#1a2348 0,#0b1020 45%,#0b1020 100%);color:var(--text);}
    .wrap{max-width:980px;margin:0 auto;padding:24px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#9b7aff);display:grid;place-items:center;box-shadow:0 10px 30px rgba(122,162,255,.25)}
    .logo span{font-weight:800;color:#0a0f1e}
    h1{font-size:20px;margin:0;color:#dfe7ff}

    .controls{display:flex;gap:10px;flex-wrap:wrap}
    .field{position:relative}
    input[type="search"]{width:260px;max-width:60vw;padding:12px 40px 12px 14px;border-radius:999px;border:1px solid #233056;background:#0d1326;color:var(--text);outline:none}
    input::placeholder{color:#7782a8}
    .icon-btn{border:1px solid #2a375e;background:#101836;color:var(--text);border-radius:999px;padding:10px 14px;cursor:pointer;display:inline-flex;gap:8px;align-items:center;transition:.2s}
    .icon-btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.25)}
    .primary{background:linear-gradient(135deg,var(--accent),#9b7aff);border-color:transparent;color:#0a0f1e;font-weight:700}
    /* .ghost{background:transparent}
    .toggle{padding:10px 12px} */

    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
    @media (max-width:860px){.grid{grid-template-columns:1fr}}

    .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.08);backdrop-filter:blur(6px);border-radius:var(--radius);box-shadow:0 10px 40px rgba(0,0,0,.35)}
    .card .hd{padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.06);display:flex;align-items:center;justify-content:space-between;color:#cbd6ff}
    .card .bd{padding:16px}

    .current{display:grid;grid-template-columns:auto 1fr;gap:14px;align-items:center}
    .temp{font-size:56px;font-weight:800;letter-spacing:-.02em}
    .big{font-size:18px;color:#c8d4ff}
    .muted{color:var(--muted)}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px dashed rgba(255,255,255,.2);border-radius:999px;padding:8px 10px;color:#d9e3ff}

    .facts{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
    .fact{padding:10px;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:rgba(255,255,255,.02);text-align:center}
    .fact .k{font-size:12px;color:#a8b3d9}
    .fact .v{font-weight:700;margin-top:2px}

    .forecast{display:grid;grid-template-columns:repeat(7,1fr);gap:10px}
    @media (max-width:860px){.forecast{grid-template-columns:repeat(4,1fr)}}
    @media (max-width:520px){.forecast{grid-template-columns:repeat(2,1fr)}}
    .day{padding:12px;border:1px solid rgba(255,255,255,.08);border-radius:14px;text-align:center}
    .day .d{color:#b9c6ff;font-size:13px}
    .day .t{margin-top:8px;font-weight:700}

    .loading{opacity:.65;pointer-events:none;filter:grayscale(.2)}
    .error{display:none;margin-top:8px;color:var(--danger);font-weight:600}
    .error.show{display:block}

    .recent{display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:#0e1430;border:1px solid #253160;border-radius:999px;padding:6px 10px;cursor:pointer}
    footer{margin:24px 0 8px;color:#8191c7;text-align:center;font-size:13px}
    a{color:var(--accent-2);text-decoration:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true" ><span>‚òÄÔ∏è</span></div>
        <h1>Weather</h1>
      </div>
      <div class="controls">
        <div class="field">
          <input id="q" type="search" placeholder="Search city (e.g., Delhi)" autocomplete="off" />
        </div>
        <button id="search" class="icon-btn primary" title="Search">Search</button>
        <button id="geo" class="icon-btn" title="Use my location">üìç My location</button>
        <button id="unit" class="icon-btn toggle" title="Toggle ¬∞C/¬∞F">¬∞C</button>
      </div>
    </header>

    <div id="err" class="error">Could not find that place. Try another city name.</div>

    <section class="grid" id="main">
      <article class="card" id="nowCard">
        <div class="hd">
          <div>
            <div class="big" id="place">‚Äî</div>
            <div class="muted" id="time">‚Äî</div>
          </div>
          <span class="pill" id="summary">‚Äî</span>
        </div>
        <div class="bd current">
          <div class="temp" id="temp">‚Äî</div>
          <div>
            <div class="muted" id="desc">‚Äî</div>
            <div class="facts">
              <div class="fact"><div class="k">Feels like</div><div class="v" id="feel">‚Äî</div></div>
              <div class="fact"><div class="k">Humidity</div><div class="v" id="hum">‚Äî</div></div>
              <div class="fact"><div class="k">Wind</div><div class="v" id="wind">‚Äî</div></div>
            </div>
          </div>
        </div>
        <div class="bd">
          <div class="muted" style="margin-bottom:8px">7‚Äëday forecast</div>
          <div class="forecast" id="forecast"></div>
        </div>
      </article>

      <aside class="card">
        <div class="hd"><span>Recent</span><button id="clearRecent" class="icon-btn ghost" style="font-size:12px">Clear</button></div>
        <div class="bd">
          <div id="recent" class="recent"></div>
          <div class="muted" style="margin-top:12px;font-size:13px">Tip: tap a chip to re‚Äëload.</div>
        </div>
      </aside>
    </section>

    <footer>
      Data via <a href="https://open-meteo.com/" target="_blank" rel="noreferrer">Open‚ÄëMeteo</a>. No API key needed. Built with ‚ô•.
    </footer>
  </div>

  <script>
    const el = (id)=>document.getElementById(id);
    const state = { unit:"C", place:null, tz:"auto" };

    const weatherMap = new Map([
      [0, "Clear sky"],[1, "Mainly clear"],[2, "Partly cloudy"],[3, "Overcast"],
      [45, "Fog"],[48, "Depositing rime fog"],[51, "Drizzle: light"],[53, "Drizzle: moderate"],[55, "Drizzle: dense"],
      [56, "Freezing drizzle: light"],[57, "Freezing drizzle: dense"],[61, "Rain: slight"],[63, "Rain: moderate"],[65, "Rain: heavy"],
      [66, "Freezing rain: light"],[67, "Freezing rain: heavy"],[71, "Snow fall: slight"],[73, "Snow fall: moderate"],[75, "Snow fall: heavy"],
      [77, "Snow grains"],[80, "Rain showers: slight"],[81, "Rain showers: moderate"],[82, "Rain showers: violent"],
      [85, "Snow showers: slight"],[86, "Snow showers: heavy"],[95, "Thunderstorm"],[96, "Thunderstorm with hail"],[99, "Thunderstorm with heavy hail"]
    ]);

    const wmoIcon = (code)=>{
      // Simple emoji icons ‚Äì replace with SVGs if you like
      if ([0,1].includes(code)) return "‚òÄÔ∏è";
      if (code===2) return "‚õÖ";
      if ([3,45,48].includes(code)) return "‚òÅÔ∏è";
      if ([51,53,55,61,63,65,80,81,82].includes(code)) return "üåßÔ∏è";
      if ([66,67].includes(code)) return "üåßÔ∏èüßä";
      if ([71,73,75,77,85,86].includes(code)) return "üå®Ô∏è";
      if ([95,96,99].includes(code)) return "‚õàÔ∏è";
      return "üå°Ô∏è";
    };

    // Helpers
    const toF = c => (c*9/5)+32;
    const formatTemp = c => state.unit === "C" ? `${Math.round(c)}¬∞C` : `${Math.round(toF(c))}¬∞F`;
    const round = n => Math.round(n);

    const setLoading = (on)=>{
      document.body.classList.toggle('loading', !!on);
    };

    const saveRecent = (label, lat, lon)=>{
      const item = {label, lat, lon, t: Date.now()};
      const arr = JSON.parse(localStorage.getItem('recent_places')||'[]');
      const filtered = arr.filter(x=>x.label.toLowerCase()!==label.toLowerCase());
      filtered.unshift(item);
      localStorage.setItem('recent_places', JSON.stringify(filtered.slice(0,8)));
      renderRecent();
    };

    const renderRecent = ()=>{
      const wrap = el('recent');
      wrap.innerHTML='';
      const arr = JSON.parse(localStorage.getItem('recent_places')||'[]');
      if(!arr.length){wrap.innerHTML = '<span class="muted">No recent places yet.</span>'; return}
      arr.forEach(({label,lat,lon})=>{
        const c = document.createElement('button');
        c.className='chip';
        c.textContent=label;
        c.onclick=()=>loadByCoords(lat,lon,label);
        wrap.appendChild(c);
      })
    };

    el('clearRecent').onclick=()=>{localStorage.removeItem('recent_places');renderRecent();};

    async function geocode(query){
      const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=1&language=en&format=json`;
      const r = await fetch(url);
      if(!r.ok) throw new Error('geocode failed');
      const d = await r.json();
      if(!d.results || !d.results.length) throw new Error('not found');
      const {name, country, latitude, longitude, timezone} = d.results[0];
      return {label:`${name}, ${country}`, lat:latitude, lon:longitude, tz:timezone};
    }

    async function fetchForecast(lat, lon, tz){
      const url = new URL('https://api.open-meteo.com/v1/forecast');
      url.searchParams.set('latitude', lat);
      url.searchParams.set('longitude', lon);
      url.searchParams.set('timezone', tz || 'auto');
      url.searchParams.set('current', 'temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m,wind_direction_10m');
      url.searchParams.set('daily','weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum');
      url.searchParams.set('forecast_days','7');
      const r = await fetch(url);
      if(!r.ok) throw new Error('forecast failed');
      return r.json();
    }

    function formatLocal(dtISO, tz){
      try{
        return new Intl.DateTimeFormat(undefined,{weekday:'short', hour:'2-digit', minute:'2-digit', day:'2-digit', month:'short', timeZone: tz||undefined}).format(new Date(dtISO));
      }catch{ return new Date(dtISO).toLocaleString(); }
    }

    function renderCurrent(data, label){
      const { current, timezone } = data;
      state.tz = timezone;
      el('place').textContent = label;
      el('time').textContent = formatLocal(current.time, timezone);
      el('temp').textContent = formatTemp(current.temperature_2m);
      el('feel').textContent = formatTemp(current.apparent_temperature);
      el('hum').textContent = `${round(current.relative_humidity_2m)}%`;
      el('wind').textContent = `${round(current.wind_speed_10m)} km/h`;
      const code = current.weather_code;
      el('summary').textContent = `${wmoIcon(code)} ${weatherMap.get(code) || '‚Äî'}`;
      el('desc').textContent = `Precipitation: ${current.precipitation ?? 0} mm ¬∑ Wind dir: ${round(current.wind_direction_10m)}¬∞`;
    }

    function renderForecast(data){
      const { daily } = data;
      const root = el('forecast');
      root.innerHTML='';
      for(let i=0;i<daily.time.length;i++){
        const date = new Date(daily.time[i]);
        const code = daily.weather_code[i];
        const hi = daily.temperature_2m_max[i];
        const lo = daily.temperature_2m_min[i];
        const elDay = document.createElement('div');
        elDay.className='day';
        elDay.innerHTML = `
          <div class="d">${date.toLocaleDateString(undefined,{weekday:'short', day:'numeric'})}</div>
          <div style="font-size:28px">${wmoIcon(code)}</div>
          <div class="muted">${weatherMap.get(code) || ''}</div>
          <div class="t">${formatTemp(lo)} / ${formatTemp(hi)}</div>
          <div class="muted" style="font-size:12px;margin-top:4px">üíß ${Math.round(daily.precipitation_sum[i]||0)} mm</div>
        `;
        root.appendChild(elDay);
      }
    }

    async function loadByCoords(lat, lon, label){
      try{
        setLoading(true); el('err').classList.remove('show');
        const data = await fetchForecast(lat, lon);
        renderCurrent(data, label);
        renderForecast(data);
        state.place = {label, lat, lon};
        saveRecent(label, lat, lon);
      }catch(e){
        console.error(e); el('err').classList.add('show');
      }finally{ setLoading(false); }
    }

    async function search(){
      const q = el('q').value.trim();
      if(!q) return;
      try{
        setLoading(true); el('err').classList.remove('show');
        const g = await geocode(q);
        await loadByCoords(g.lat, g.lon, g.label);
      }catch(e){
        console.error(e); el('err').classList.add('show');
      }finally{ setLoading(false); }
    }

    el('search').onclick = search;
    el('q').addEventListener('keydown', e=>{ if(e.key==='Enter') search(); });

    el('unit').onclick = ()=>{
      state.unit = state.unit==='C' ? 'F' : 'C';
      el('unit').textContent = `¬∞${state.unit}`;
      // re-render temps if we have data
      if(state.place){ loadByCoords(state.place.lat, state.place.lon, state.place.label); }
    }

    el('geo').onclick = ()=>{
      if(!navigator.geolocation){ alert('Geolocation not supported'); return; }
      navigator.geolocation.getCurrentPosition(async pos=>{
        const {latitude:lat, longitude:lon} = pos.coords;
        try{
          setLoading(true); el('err').classList.remove('show');
          // Reverse geocode to get a nice label
          const rev = await fetch(`https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&language=en&format=json`)
            .then(r=>r.json()).catch(()=>null);
          const label = rev?.results?.[0] ? `${rev.results[0].name}, ${rev.results[0].country}` : 'My location';
          await loadByCoords(lat, lon, label);
        }catch(e){ console.error(e); el('err').classList.add('show'); }
        finally{ setLoading(false); }
      }, err=>{ alert('Could not get your location.'); console.warn(err); });
    };

    // Boot: try last place or a default
    renderRecent();
    (async ()=>{
      const arr = JSON.parse(localStorage.getItem('recent_places')||'[]');
      if(arr[0]){ loadByCoords(arr[0].lat, arr[0].lon, arr[0].label); }
      else{ loadByCoords(28.6139,77.2090,'New Delhi, India'); }
    })();
  </script>
</body>
</html>
